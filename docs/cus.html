<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <link rel="stylesheet" type="text/css" href="qtstalker.css"
 media="screen">
  <script type="text/javascript" src="qtstalker.js">
 </script>
  <title>Qtstalker: Script API overview</title>
  <meta http-equiv="content-type"
 content="text/html; charset=ISO-8859-1">
</head>
<body>
<div id="content">
<div id="rightPanel">
<div id="version"></div>
<div id="toc">
<hr>
<ul>
  <li><a href="index.html">Home</a></li>
  <li><a href="toc.html">Table of Contents</a></li>
</ul>
</div>
</div>
<h1>Script API overview</h1>
<p>Custom (CUS) indicators can be constructed using scripts. Also used for
data-loading and management, and for launching external facilities.
</p>

<p>
These scripts can be written in any popular scripting language that can read / write to
STDIN and STDOUT. Languages like Perl, Python, PHP etc. The pre-installed scripts
provided are written in Perl. See the scripts in the
<code>qtstalker/Scripts/indicator/</code> directory.
Also see the contributed "<a href="#examples">CUS
Examples Repository</a>" for examples.</p>
<p> For a description of available indicators for scripts see the
<a href="indicatorreference.html">Indicator Reference</a> and the
<a href="toc.html#api">API documentation</a>.
</p>
<h3>Basic Script Example</h3>
<p>Here is an example of a basic script using perl. There are 3 fundamental
steps to each script. </p>
<ol>
  <li>Turn on autoflush. Most scripting languages have this function.
This is required by qtstalker in order to make sure all data being
sent/received by qtstallker and the script are complete and not
buffered.</li>
  <li>Create the indicators.</li>
  <li>Plot the desired indicators.</li>
</ol>
<p>Turn on autoflush.</p>
<p></p>
<p style="margin-left: 4em;">$|++;</p>
<p></p>
<p>Now we create a "Close" indicator. Each indicator has a format. We
consult the
indicator reference to determine the proper format and make the
request. The
request to create an indicator is made to STDOUT. The request is a
string in
the proper format to create a Close indicator.</p>
<p></p>
<pre>print STDOUT 'PLUGIN=DOHLCVI,METHOD=C,NAME=close_0';</pre>
<p></p>
<p>Each time we communicate with Qtstalker, a return code is returned
from
STDIN. This lets the script know if what we requested was successful. A
0 is
returned on success and 1 on failure. If there was a failure then the
script
should exit immediately. <span
 style="font-style: italic; text-decoration: underline; font-weight: bold;">NOTE:</span>
<span style="font-style: italic;">The return code must be read by the
script even if it is not needed. This clears the buffer and allows app
and script to continue. Otherwise, the script and app will hang until
the buffer is cleared.</span><br>
</p>
<p></p>
<p>$a = &lt;STDIN&gt;; </p>
<p></p>
<p>The return code is a string with a carriage return, so we strip off
the
carriage return so we can do a comparison and act accordingly. In perl
we use
the chomp function.</p>
<p></p>
<p>chomp($a); </p>
<p></p>
<p>Now we find out what the return code is. If failure we exit the
script.</p>
<p></p>
<p>if ($a ne '0')</p>
<p>{</p>
<p>exit;</p>
<p>}</p>
<p></p>
<p>If we got this far then everything has been successful. Now that we
have our
Close indicator, we plot it. The next command tells Qtstalker to plot
our Close
indicator. Consult the Indicator API for the plot command format for
details.</p>
<p></p>
<pre>print STDOUT 'PLUGIN=INDICATOR_PLOT_ALL,NAME=close_0,STYLE=Line,COLOR=yellow,Z=1'; </pre>
<p>Once again we have to check to see if our plot command was
successful. The
procedure is the same as the above example.</p>
<pre>$a = &lt;STDIN&gt;; chomp($a); if ($a ne '0') { exit; }</pre>
<p>If we are here then our script was a success. Almost any indicator
can be
created in this manner. There are over a hundred indicators, and
functions to
pass indicator data directly back and forth between scripts and
Qtstalker so
that complex calculations can be performed. Consult the script API
section for
details.</p>
<h4 id="debug">Debug techniques</h4>
<p> If your indicator script is using the Script API incorrectly, then
the script will fail at this point and processing will terminate.
Review the console log as there may be some error message.
</p>
<p> To assist with debugging, printing to Standard Error will send the
message to the console. So while developing, sprinkle <code>print
STDERR "XXXX";</code> type statements in your code.
</p>
<h4><a name="examples" id="examples">CUS Examples Repository</a></h4>
<p>See the directories "misc/CUS_examples/" See the documentation and
how to contribute.
</p>
</div>
</body>
</html>
